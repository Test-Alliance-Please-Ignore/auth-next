import { DurableObject } from 'cloudflare:workers'

import { MigratableDurableObject, loadMigrationsFromBuild } from '@repo/do-migrations'
import { logger } from '@repo/hono-helpers'

import type { Env } from './context'
import { {{ camelCase name }}Migrations } from './migrations'

// ========== Internal Types (SQLite data structures - snake_case) ==========

// Add your SQLite row types here (snake_case)
// Example:
// export interface ExampleData extends Record<string, number | string> {
// 	id: string
// 	created_at: number
// 	updated_at: number
// }

// ========== Public Types (External API - camelCase) ==========

// Add your public types here (camelCase)
// Example:
// export interface Example {
// 	id: string
// 	createdAt: number
// 	updatedAt: number
// }

/**
 * {{ pascal name }} Durable Object Implementation
 *
 * {{ description }}
 */
export class {{ pascal name }} extends MigratableDurableObject {
	constructor(ctx: DurableObjectState, env: Env) {
		super(ctx, env, {
			migrationDir: '{{ pascal name }}',
			autoMigrate: true,
			verbose: env.ENVIRONMENT === 'development',
		})
	}

	/**
	 * Override loadMigrations to provide the embedded SQL files
	 */
	protected async loadMigrations() {
		return loadMigrationsFromBuild({{ camelCase name }}Migrations)
	}

	// ========== Public Methods ==========

	async exampleMethod(): Promise<string> {
		// TODO: Implement your method
		logger
			.withTags({
				type: 'example_method_called',
			})
			.info('Example method called')

		return 'Hello from {{ pascal name }}!'
	}
}
